"use strict";(()=>{var e={};e.id=651,e.ids=[651],e.modules={2651:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.d(a,{G6:()=>p,Hh:()=>m,Jv:()=>d,hu:()=>c,zR:()=>u});var r=t(4337),i=t(6168),n=t(5486),l=t.n(n),o=e([r,i]);[r,i]=o.then?(await o)():o;let g=(0,r.getFirestore)(i.A);async function u(e){return(await (0,r.getDocs)((0,r.collection)(g,e))).docs.map(e=>({id:e.id,...e.data()}))}async function c(e,a){return(await (0,r.getDoc)((0,r.doc)(g,e,a))).data()}async function d({email:e,password:a}){if(""===e||""===a)return null;let t=(0,r.query)((0,r.collection)(g,"users"),(0,r.where)("email","==",e),(0,r.where)("type","==","credential"));return(await (0,r.getDocs)(t)).docs.map(e=>({id:e.id,email:e.data().email,fullname:e.data().fullname,password:e.data().password,image:e.data().image||"",type:e.data().type||"",role:e.data().role}))[0]||null}async function m(e,a){if(""===e.fullname){a({status:!1,message:"Fullname is Required!"});return}if(""===e.email){a({status:!1,message:"Email is Required!"});return}if(""===e.password){a({status:!1,message:"Password is Required!"});return}let t=(0,r.query)((0,r.collection)(g,"users"),(0,r.where)("email","==",e.email));(await (0,r.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()})).length>0?a({status:!1,message:"Email Already Exists"}):(e.password=await l().hash(e.password,10),e.type="credential",e.role="member",await (0,r.addDoc)((0,r.collection)(g,"users"),e).then(()=>{a({status:!0,message:"Register Success"})}).catch(e=>{a({status:!1,message:e})}))}async function p(e,a){let t=(0,r.query)((0,r.collection)(g,"users"),(0,r.where)("email","==",e.email)),s=(await (0,r.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()}));s.length>0?(e.role=s[0].role,await (0,r.updateDoc)((0,r.doc)(g,"users",s[0].id),e).then(()=>{a({status:!0,message:"Sign In with Google Success!",data:e})}).catch(()=>{a({status:!1,message:"Sign In with Google Failed!"})})):(e.role="member",await (0,r.addDoc)((0,r.collection)(g,"users"),e).then(()=>{a({status:!0,message:"Sign In with Google Success!",data:e})}).catch(()=>{a({status:!1,message:"Sign In with Google Failed!"})}))}s()}catch(e){s(e)}})},3480:(e,a,t)=>{e.exports=t(5600)},4337:e=>{e.exports=import("firebase/firestore")},5486:e=>{e.exports=require("bcrypt")},5542:e=>{e.exports=require("next-auth")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6168:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.d(a,{A:()=>l});var r=t(6551),i=e([r]);r=(i.then?(await i)():i)[0];let n={apiKey:process.env.FIREBASE_API_KEY,authDomain:process.env.FIREBASE_AUTH_DOMAIN,projectId:process.env.FIREBASE_PROJECT_ID,storageBucket:process.env.FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.FIREBASE_MESSAGING_SENDER_ID,appId:process.env.FIREBASE_APP_ID},l=(0,r.initializeApp)(n);s()}catch(e){s(e)}})},6382:e=>{e.exports=require("next-auth/providers/credentials")},6435:(e,a)=>{Object.defineProperty(a,"M",{enumerable:!0,get:function(){return function e(a,t){return t in a?a[t]:"then"in a&&"function"==typeof a.then?a.then(a=>e(a,t)):"function"==typeof a&&"default"===t?a:void 0}}})},6551:e=>{e.exports=import("firebase/app")},7324:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.r(a),t.d(a,{default:()=>g});var r=t(2651),i=t(5486),n=t(5542),l=t.n(n),o=t(6382),u=t.n(o),c=t(7851),d=t.n(c),m=e([r]);r=(m.then?(await m)():m)[0];let p={session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET,providers:[u()({type:"credentials",name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e,a){let{email:t,password:s}=e,n=await (0,r.Jv)({email:t,password:s});return n&&await (0,i.compare)(s,n.password)?n:null}}),d()({clientId:process.env.GOGGLE_OAUTH_CLIENT_ID||"",clientSecret:process.env.GOGGLE_OAUTH_CLIENT_SECRET||""})],callbacks:{async jwt({token:e,account:a,profile:t,user:s}){if(a?.provider==="credentials"&&(e.email=s.email,e.fullname=s.fullname,e.type="credential",e.image=s.image||"",e.role=s.role),a?.provider==="google"){let a={email:s.email,fullname:s.name,image:s.image,type:"google"};await (0,r.G6)(a,a=>{a.status&&(e.email=a.data.email,e.fullname=a.data.fullname,e.type=a.data.type,e.image=a.data.image,e.role=a.data.role)})}return e},session:async({session:e,token:a})=>("email"in a&&(e.user.email=a.email),"fullname"in a&&(e.user.fullname=a.fullname),"type"in a&&(e.user.type=a.type),"image"in a&&(e.user.image=a.image),"role"in a&&(e.user.role=a.role),e)},pages:{signIn:"/auth/login"}},g=l()(p);s()}catch(e){s(e)}})},7851:e=>{e.exports=require("next-auth/providers/google")},7920:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.r(a),t.d(a,{config:()=>c,default:()=>u,routeModule:()=>d});var r=t(3480),i=t(8667),n=t(6435),l=t(7324),o=e([l]);l=(o.then?(await o)():o)[0];let u=(0,n.M)(l,"default"),c=(0,n.M)(l,"config"),d=new r.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/auth/[...nextauth]",pathname:"/api/auth/[...nextauth]",bundlePath:"",filename:""},userland:l});s()}catch(e){s(e)}})},8667:(e,a)=>{Object.defineProperty(a,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var a=require("../../../webpack-api-runtime.js");a.C(e);var t=a(a.s=7920);module.exports=t})();